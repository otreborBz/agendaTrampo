{
    "sourceFile": "src/services/firebase/userService.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1759371026216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759433397458,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,10 @@\n import { createUserWithEmailAndPassword, sendPasswordResetEmail, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\n import { doc, getDoc, setDoc } from 'firebase/firestore';\r\n+import { createUserWithEmailAndPassword, deleteUser, sendPasswordResetEmail, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\n+import { doc, getDoc, setDoc, deleteDoc, collection, query, where, getDocs } from 'firebase/firestore';\r\n import { auth, db } from './firebaseConnection';\r\n+import { deleteUserData as deleteFirestoreUserData } from './firestoreService';\r\n \r\n /**\r\n  * Autentica um usuário com email e senha e busca seus dados no Firestore.\r\n  * @param {string} email - O email do usuário.\r\n@@ -15,17 +18,17 @@\n     const userDocRef = doc(db, \"users\", user.uid);\r\n     const userSnapshot = await getDoc(userDocRef);\r\n \r\n     if (userSnapshot.exists()) {\r\n-        return userSnapshot.data();\r\n+      return userSnapshot.data();\r\n     } else {\r\n-        // O usuário existe na autenticação, mas não no Firestore.\r\n-        // Isso pode acontecer se o documento foi excluído manualmente.\r\n-        // Vamos recriar o documento do usuário para evitar o bloqueio do login.\r\n-        console.warn(`Recriando documento para o usuário ${user.uid} que não foi encontrado no Firestore.`);\r\n-        const userData = { uid: user.uid, email: user.email, name: user.email, createdAt: new Date() };\r\n-        await setDoc(userDocRef, userData);\r\n-        return userData;\r\n+      // O usuário existe na autenticação, mas não no Firestore.\r\n+      // Isso pode acontecer se o documento foi excluído manualmente.\r\n+      // Vamos recriar o documento do usuário para evitar o bloqueio do login.\r\n+      console.warn(`Recriando documento para o usuário ${user.uid} que não foi encontrado no Firestore.`);\r\n+      const userData = { uid: user.uid, email: user.email, name: user.email, createdAt: new Date() };\r\n+      await setDoc(userDocRef, userData);\r\n+      return userData;\r\n     }\r\n   } catch (error) {\r\n     if ([\"auth/user-not-found\", \"auth/wrong-password\", \"auth/invalid-credential\"].includes(error.code)) {\r\n       throw new Error(\"E-mail ou senha inválidos.\");\r\n@@ -80,9 +83,9 @@\n /** \r\n Verifica senha inserida se tem minuscula, maiuscula, numero e minimo de 8 caracter\r\n @returns {boolean}\r\n @throws {Error}\r\n-**/ \r\n+**/\r\n export function validarSenha(senha) {\r\n   const regexSenha = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}$/;\r\n   if (!regexSenha.test(senha)) {\r\n     throw new Error(\"A senha deve conter pelo menos 8 caracteres, uma letra maiúscula, uma letra minúscula e um número.\");\r\n@@ -95,12 +98,41 @@\n  * @param {String} email \r\n  * @returns { boolean}\r\n  * @throws {Error}\r\n  */\r\n-export async function redefinirSenha(email){\r\n+export async function redefinirSenha(email) {\r\n   try {\r\n     await sendPasswordResetEmail(auth, email);\r\n     return true;\r\n   } catch (error) {\r\n     throw new Error(\"Não foi possível redefinir a senha. Verifique o email digitado e tente novamente.\");\r\n   }\r\n }\r\n+\r\n+/**\r\n+ * Exclui a conta do usuário logado e todos os seus dados.\r\n+ * Requer que o usuário tenha feito login recentemente.\r\n+ * @returns {Promise<void>}\r\n+ * @throws {Error} Lança um erro com uma mensagem amigável em caso de falha.\r\n+ */\r\n+export async function deleteUserAccount() {\r\n+  const user = auth.currentUser;\r\n+\r\n+  if (!user) {\r\n+    throw new Error(\"Nenhum usuário logado para excluir.\");\r\n+  }\r\n+\r\n+  try {\r\n+    // 1. Excluir todos os dados do usuário no Firestore\r\n+    await deleteFirestoreUserData(user.uid);\r\n+\r\n+    // 2. Excluir o usuário do Firebase Authentication\r\n+    await deleteUser(user);\r\n+\r\n+  } catch (error) {\r\n+    console.error(\"Erro ao excluir conta do usuário:\", error);\r\n+    if (error.code === 'auth/requires-recent-login') {\r\n+      throw new Error(\"Esta é uma operação sensível. Por favor, faça login novamente antes de excluir sua conta.\");\r\n+    }\r\n+    throw new Error(\"Não foi possível excluir a conta. Tente novamente mais tarde.\");\r\n+  }\r\n+}\r\n"
                },
                {
                    "date": 1759433472398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,7 @@\n import { createUserWithEmailAndPassword, sendPasswordResetEmail, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\n import { doc, getDoc, setDoc } from 'firebase/firestore';\r\n-import { createUserWithEmailAndPassword, deleteUser, sendPasswordResetEmail, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\n-import { doc, getDoc, setDoc, deleteDoc, collection, query, where, getDocs } from 'firebase/firestore';\r\n import { auth, db } from './firebaseConnection';\r\n-import { deleteUserData as deleteFirestoreUserData } from './firestoreService';\r\n \r\n /**\r\n  * Autentica um usuário com email e senha e busca seus dados no Firestore.\r\n  * @param {string} email - O email do usuário.\r\n@@ -106,33 +103,4 @@\n   } catch (error) {\r\n     throw new Error(\"Não foi possível redefinir a senha. Verifique o email digitado e tente novamente.\");\r\n   }\r\n }\r\n-\r\n-/**\r\n- * Exclui a conta do usuário logado e todos os seus dados.\r\n- * Requer que o usuário tenha feito login recentemente.\r\n- * @returns {Promise<void>}\r\n- * @throws {Error} Lança um erro com uma mensagem amigável em caso de falha.\r\n- */\r\n-export async function deleteUserAccount() {\r\n-  const user = auth.currentUser;\r\n-\r\n-  if (!user) {\r\n-    throw new Error(\"Nenhum usuário logado para excluir.\");\r\n-  }\r\n-\r\n-  try {\r\n-    // 1. Excluir todos os dados do usuário no Firestore\r\n-    await deleteFirestoreUserData(user.uid);\r\n-\r\n-    // 2. Excluir o usuário do Firebase Authentication\r\n-    await deleteUser(user);\r\n-\r\n-  } catch (error) {\r\n-    console.error(\"Erro ao excluir conta do usuário:\", error);\r\n-    if (error.code === 'auth/requires-recent-login') {\r\n-      throw new Error(\"Esta é uma operação sensível. Por favor, faça login novamente antes de excluir sua conta.\");\r\n-    }\r\n-    throw new Error(\"Não foi possível excluir a conta. Tente novamente mais tarde.\");\r\n-  }\r\n-}\r\n"
                }
            ],
            "date": 1759371026216,
            "name": "Commit-0",
            "content": "import { createUserWithEmailAndPassword, sendPasswordResetEmail, signInWithEmailAndPassword, signOut } from 'firebase/auth';\r\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\r\nimport { auth, db } from './firebaseConnection';\r\n\r\n/**\r\n * Autentica um usuário com email e senha e busca seus dados no Firestore.\r\n * @param {string} email - O email do usuário.\r\n * @param {string} password - A senha do usuário.\r\n * @returns {Promise<object>} - Retorna o objeto do usuário do Firestore.\r\n * @throws {Error} - Lança um erro com uma mensagem amigável em caso de falha.\r\n */\r\nexport async function signInUser(email, password) {\r\n  try {\r\n    const { user } = await signInWithEmailAndPassword(auth, email, password);\r\n    const userDocRef = doc(db, \"users\", user.uid);\r\n    const userSnapshot = await getDoc(userDocRef);\r\n\r\n    if (userSnapshot.exists()) {\r\n        return userSnapshot.data();\r\n    } else {\r\n        // O usuário existe na autenticação, mas não no Firestore.\r\n        // Isso pode acontecer se o documento foi excluído manualmente.\r\n        // Vamos recriar o documento do usuário para evitar o bloqueio do login.\r\n        console.warn(`Recriando documento para o usuário ${user.uid} que não foi encontrado no Firestore.`);\r\n        const userData = { uid: user.uid, email: user.email, name: user.email, createdAt: new Date() };\r\n        await setDoc(userDocRef, userData);\r\n        return userData;\r\n    }\r\n  } catch (error) {\r\n    if ([\"auth/user-not-found\", \"auth/wrong-password\", \"auth/invalid-credential\"].includes(error.code)) {\r\n      throw new Error(\"E-mail ou senha inválidos.\");\r\n    }\r\n    console.error(\"Erro em signInUser:\", error);\r\n    throw new Error(\"Não foi possível fazer login. Tente novamente.\");\r\n  }\r\n}\r\n\r\n/**\r\n * Cria um novo usuário com email/senha e salva seus dados no Firestore.\r\n * @param {string} name - O nome do usuário.\r\n * @param {string} email - O email do usuário.\r\n * @param {string} password - A senha do usuário.\r\n * @returns {Promise<object>} - Retorna o objeto do usuário criado em caso de sucesso.\r\n * @throws {Error} - Lança um erro com uma mensagem amigável em caso de falha.\r\n */\r\nexport async function signUpUser(name, email, password) {\r\n  try {\r\n    const { user } = await createUserWithEmailAndPassword(auth, email, password);\r\n    const userDocRef = doc(db, \"users\", user.uid);\r\n    await setDoc(userDocRef, { uid: user.uid, name, email, createdAt: new Date() });\r\n    return user;\r\n  } catch (error) {\r\n    if (error.code === \"auth/email-already-in-use\") {\r\n      throw new Error(\"Este e-mail já está em uso.\");\r\n    } else if (error.code === \"auth/weak-password\") {\r\n      throw new Error(\"A senha deve ter pelo menos 6 caracteres.\");\r\n    } else if (error.code === \"auth/invalid-email\") {\r\n      throw new Error(\"O e-mail informado não é válido.\");\r\n    }\r\n    console.error(\"Erro em signUpUser:\", error);\r\n    throw new Error(\"Não foi possível criar o usuário. Tente novamente.\");\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Desloga o usuário atual do Firebase.\r\n * @returns {Promise<void>}\r\n * @throws {Error} Lança um erro se não for possível fazer logout.\r\n */\r\nexport async function logoutUser() {\r\n  try {\r\n    await signOut(auth);\r\n  } catch (error) {\r\n    console.error(\"Erro em logoutUser:\", error);\r\n    throw new Error(\"Não foi possível fazer logout. Tente novamente.\");\r\n  }\r\n}\r\n\r\n/** \r\nVerifica senha inserida se tem minuscula, maiuscula, numero e minimo de 8 caracter\r\n@returns {boolean}\r\n@throws {Error}\r\n**/ \r\nexport function validarSenha(senha) {\r\n  const regexSenha = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}$/;\r\n  if (!regexSenha.test(senha)) {\r\n    throw new Error(\"A senha deve conter pelo menos 8 caracteres, uma letra maiúscula, uma letra minúscula e um número.\");\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * \r\n * @param {String} email \r\n * @returns { boolean}\r\n * @throws {Error}\r\n */\r\nexport async function redefinirSenha(email){\r\n  try {\r\n    await sendPasswordResetEmail(auth, email);\r\n    return true;\r\n  } catch (error) {\r\n    throw new Error(\"Não foi possível redefinir a senha. Verifique o email digitado e tente novamente.\");\r\n  }\r\n}\r\n"
        }
    ]
}